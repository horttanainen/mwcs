var sol=function(){"use strict";var e=function(e){sol.shell.initModule(e)};return{initModule:e}}();sol.model=function(){"use strict";var e,t,n,r,i,a,l={shift_db:TAFFY(),employee_db:TAFFY(),shift_cid:0};return e={total_earn:0,total_hours:0,regular_earn:0,regular_hours:0,overtime_earn:0,overtime_hours:0,evening_earn:0,evening_hours:0},t={total_earn:0,total_hours:0,regular_earn:0,regular_hours:0,overtime_earn:0,overtime_hours:0,evening_earn:0,evening_hours:0},n=function(t){var n,r=t.name,i=t.id;return n=Object.create(e),n.name=r,n.id=i,l.employee_db.insert(n),n},r=function(e){var n,r=e.employee,i=e.date,a=e.date_start,o=e.date_end;return n=Object.create(t),n.employee_id=r.id,n.date=i,n.shift_start=a,n.shift_end=o,n.id=l.shift_cid++,l.shift_db.insert(n),n},i=function(){var e,t,r,i;return e=function(){return l.employee_db},t=function(e){var t;return t=l.employee_db({id:e.id}).first(),t||(t=n({name:e.name,id:e.id})),t},i=function(e,t){l.employee_db({id:e}).update(function(){var e=t[0],n=t[1],r=n+(this[e]||0);return r=Math.round(100*r)/100,this[e]=r,this})},r=function(){l.employee_db=TAFFY()},{update_employee:i,clear_db:r,get_db:e,get_employee:t}}(),a=function(){var e,t,n;return e=function(){return l.shift_db},t=function(){l.shift_db=TAFFY(),l.shift_cid=0},n=function(e,t){var n=t[0],r=t[1];l.shift_db({id:e}).update(n,r)},{update_shift:n,clear_db:t,get_db:e}}(),{makeShift:r,makeEmployee:n,employees:i,shifts:a}}(),sol.shell=function(){"use strict";var e,t,n,r={main_html:String()+'<div class="sol-shell-head"><div class="sol-shell-head-logo"><div class="sol-shell-head-logo-stage"><div class="sol-shell-head-logo-stage-ball"><h1>MWCS</h1></div><div class="sol-shell-head-logo-stage-shadow"></div></div></div></div><div class="sol-shell-main"><div class="sol-shell-main-file"></div><div class="sol-shell-main-list"></div></div>'},i={$container:void 0},a={};return e=function(){var e=i.$container;a={$container:e,$file:e.find(".sol-shell-main-file"),$list:e.find(".sol-shell-main-list"),$logo:e.find(".sol-shell-head-logo")}},t=function(t){i.$container=t,t.html(r.main_html),e(),a.$logo.bind("click",n),$.gevent.subscribe(t,"error",n),sol.file.initModule(a.$file),sol.list.initModule(a.$list),sol.model.shifts.clear_db(),sol.model.employees.clear_db()},n=function(){t(i.$container)},{initModule:t}}(),sol.list=function(){"use strict";var e,t,n,r,i,a,l,o,s,d={main_html:String()+'<ul class="sol-shell-main-list-employees"></ul>'},u={$container:void 0},c={};return e=function(){var e=u.$container;c={$container:e,$employees:e.find(".sol-shell-main-list-employees")}},t=function(){c.$employees.bind("click",o)},n=function(){c.$container.html(d.main_html),e(),r(),t()},r=function(){var e,t,n,r=sol.model.employees.get_db(),i=r().get();for(e=0;e<i.length;e++)t=i[e],n='<li name="'+t.id+'">'+t.name+", $"+t.total_earn+"<hr></li>",c.$employees.append(n)},i=function(e){c.$container.html(String()+'<table class="sol-shell-main-list-employee-table"><div class="sol-shell-main-list-employee-header"><span>'+e.name+"</span> (ID "+e.id+")</div><tr><td>Evening Compensation</td><td>"+e.evening_hours+"h</td><td>$"+e.evening_earn+"</td></tr><tr><td>Overtime Compensation</td><td>"+e.overtime_hours+"h</td><td>$"+e.overtime_earn+"</td></tr><tr><td>Regular work</td><td>"+e.regular_hours+"h</td><td>$"+e.regular_earn+"</td></tr><tr><td>Total Pay</td><td>"+e.total_hours+"h</td><td>$"+e.total_earn+'</td></tr></table><div class="sol-shell-main-list-employee-back">Back to List</div>')},a=function(){$(".sol-shell-main-list-employee-back").bind("click",n)},l=function(e){var t,n;t=sol.model.employees.get_db(),n=t({id:e}).first(),i(n),a()},o=function(e){e.target.getAttribute("name")&&l(parseInt(e.target.getAttribute("name"),10))},s=function(t){u.$container=t,t.html(d.main_html),e(),$.gevent.subscribe(t,"db-update",r),c.$employees.bind("click",o)},{initModule:s}}(),sol.file=function(){"use strict";var e,t,n,r,i,a={main_html:String()+'<div class="sol-shell-main-file-drop"><div class="sol-shell-main-file-drop-header">Drop a .csv file here </div><div class="or">or</div><div class="sol-shell-main-file-regular"><label><div class="sol-shell-main-file-regular-header"> Select a .csv file </div><input type="file" id="regular-input" name="files[]" multiple /></label></div></div>'},l={$container:void 0},o={};return e=function(){var e=l.$container;o={$container:e,$regular_input:e.find("#regular-input"),$drop_input:e.find(".sol-shell-main-file-drop")}},t=function(e){e.stopPropagation(),e.preventDefault();try{sol.csv_handler.readCsvFile(e,sol.salary_calculator.calculateAllWagesAndAddToDb),$(this).removeClass("dragover")}catch(t){}},n=function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy",$(this).addClass("dragover")},r=function(e){e.preventDefault(),e.stopPropagation(),$(this).removeClass("dragover")},i=function(i){l.$container=i,i.html(a.main_html),e(),o.$regular_input.bind("change",t),o.$drop_input.bind("dragover",n),o.$drop_input.bind("dragleave",r),o.$drop_input.bind("drop",t)},{initModule:i}}(),sol.salary_calculator=function(){"use strict";var e,t,n,r,i,a,l,o,s,d,u,c,f,m={regular_wage:3.75,evening_compensation:4.9,evening:18,morning:6,nextday_morning:30,nextday_evening:42,regular_day_length:8,overtime_compensation_percents:{first_two:.25,two_to_four:.5,after_four:1}};return e=function(e){return Math.round(100*(e+1e-5))/100},t=function(e,t){var n=e.employee_id,r=e.id;sol.model.employees.update_employee(n,t),sol.model.shifts.update_shift(r,t)},n=function(t){var n,r=36e5;return n=(t.shift_end.getTime()-t.shift_start.getTime())/r,e(n)},r=function(e){var t,n,r,i=m.nextday_morning,a=m.nextday_evening,l=36e5;return t=(e.shift_end.getTime()-e.date.getTime())/l,r=t-i,n=t-a,n>0&&(r-=n),0>=r?0:r},i=function(e){var t,n,r,i,a=m.evening,l=m.morning,o=36e5;return t=(e.shift_start.getTime()-e.date.getTime())/o,i=(e.shift_end.getTime()-e.date.getTime())/o,r=Math.min(a,i)-t,n=l-t,n>0&&(r-=n),0>=r?0:r},a=function(t){var a,l,o,s;return a=n(t),l=i(t),o=r(t),s=a-l-o,e(s)},l=function(n){var r;return r=a(n),t(n,["evening_hours",r]),e(r*m.evening_compensation)},o=function(e,t){var n=m.regular_wage;return n*t*e},s=function(e){var t,n=m.overtime_compensation_percents.first_two,r=m.overtime_compensation_percents.two_to_four,i=m.overtime_compensation_percents.after_four,a=0;return 0>=e?0:(e>4&&(t=e-4,a+=o(t,i)),e>2&&(t=Math.min(2,e-2),a+=o(t,r)),e>0&&(t=Math.min(2,e),a+=o(t,n)),a)},d=function(r){var i,a;return a=n(r),i=Math.max(a-m.regular_day_length,0),t(r,["overtime_hours",i]),t(r,["total_hours",a]),e(s(i))},u=function(r){var i,l;return l=a(r),i=Math.min(m.regular_day_length,n(r)),i-=l,t(r,["regular_hours",i]),e(m.regular_wage*i)},c=function(n){var r,i,a,o;return r=u(n),i=l(n),a=d(n),o=e(r+i+a),t(n,["regular_earn",r]),t(n,["evening_earn",i]),t(n,["overtime_earn",a]),o},f=function(){var e,n,r,i,a=sol.model.shifts.get_db();for(e=a().get(),n=0;n<e.length;n++)i=e[n],r=c(i),t(i,["total_earn",r]);$.gevent.publish("db-update"),$(".sol-shell-main-file").addClass("sol-x-clearfloat")},{overtimeCompensationForShift:d,eveningHoursInShift:a,totalPayForShift:c,calculateAllWagesAndAddToDb:f}}(),sol.csv_handler=function(){var e,t,n,r,i,a,l,o,s,d;return e=function(e){var t,n,r,i;return t=e.split("."),n=parseInt(t[0],10),i=parseInt(t[1],10),r=parseInt(t[2],10),new Date(r,i,n)},t=function(e,t){return 60*e*60*1e3+60*t*1e3},n=function(e,n){var r,i,a,l;return r=n.split(":"),i=parseInt(r[0],10),a=parseInt(r[1],10),l=t(i,a),new Date(e.getTime()+l)},r=function(e,t){return e+":"+t},i=function(e,t){return e>t?!0:!1},a=function(e,t){var n,a,l,o,s;return n=e.split(":"),a=t.split(":"),l=parseInt(n[0],10),o=parseInt(a[0],10),s=parseInt(a[1],10),i(l,o)&&(o+=24),r(o,s)},l=function(t){var r,i,l,o,s,d,u,c,f,m;return i=t[0],l=parseInt(t[1],10),o=t[2],u=t[3],c=t[4],r=sol.model.employees.get_employee({id:l,name:i}),c=a(u,c),f=e(o),s=n(f,u),d=n(f,c),m={employee:r,date:f,date_start:s,date_end:d},sol.model.makeShift(m),m},o=function(e){var t,n,r,i,a=e[1],l=e[2],o=e[3],s=e[4];if(t=l.split("."),n=o.split(":"),r=s.split(":"),isNaN(parseInt(a,10)))return!0;for(i=0;i<t.length;i++)if(isNaN(parseInt(t[i],10)))return!0;for(i=0;i<n.length;i++)if(isNaN(parseInt(n[i],10)))return!0;for(i=0;i<r.length;i++)if(isNaN(parseInt(r[i],10)))return!0;return!1},s=function(e){var t;if(t=e.split(","),5!==t.length)throw new Error("Bad Input!");if(o(t))throw new Error("Bad Input!");return l(t)},d=function(e,t){var n,r,i,a,l=new FileReader;if(n=e.target.files?e.target.files:e.originalEvent.dataTransfer.files,a=n[0],!a)throw new Error("Bad Input!");l.onload=function(){for(r=this.result.split("\n"),i=1;i<r.length;i++)if(r[i].length>0)try{s(r[i])}catch(e){return void $.gevent.publish("error")}t()};try{l.readAsText(a,"UTF-8")}catch(o){throw new Error("Bad Input!")}},{readCsvFile:d,splitLine:s}}();